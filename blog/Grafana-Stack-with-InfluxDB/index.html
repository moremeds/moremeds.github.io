<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Grafana Stack with InfluxDB · Chenxi LI</title><meta name="description" content="Collecting and analyzing metrics are the key to understand a system’s runtime behaviors and thus to provide a better guideline of optimization. As the user of a metrics system, you might want to collect metric and event with simple APIs, retrieve historical metric data, and view visualized metrics statistics.
This article shows you how to build a metric system with StatsD, influxdb, and &lt;a href=&quot;http://grafana.org/&quot; target=&quot;_blank&quot; rel=&quot;exte"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.ico"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">ARCHIVES</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="https://github.com/moremeds" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Grafana Stack with InfluxDB</h1><div class="post-meta"><div class="post-time">Jan 3, 2016</div></div><div class="post-content"><p>Collecting and analyzing metrics are the key to understand a system’s runtime behaviors and thus to provide a better guideline of optimization. As the user of a metrics system, you might want to collect metric and event with simple APIs, retrieve historical metric data, and view visualized metrics statistics.</p>
<p>This article shows you how to build a metric system with <a href="https://github.com/etsy/statsd" target="_blank" rel="external">StatsD</a>, <a href="https://influxdata.com/" target="_blank" rel="external">influxdb</a>, and <a href="http://grafana.org/" target="_blank" rel="external">Grafana</a>, as an example metrics system that composes of a client, a data storage, and visualization UI. There are many available open source packages.</p>
<p><img src="/images/grafana/LogicFlow.png" width="60%" height="60%"></p>
<a id="more"></a>
<p>The figure above shows you the data flow. User configures the application, and sends metrics to StatsD server. StatsD stores the metrics data in InfluxDB, a time-series database, where Grafana retrieves data and displays the visualized metrics.</p>
<p>Let’s briefly discuss the software collection before moving on to configuration.</p>
<ul>
<li>StatsD is a daemon that collects and aggregates metrics data. With the well-accepted UDP protocol, <a href="https://github.com/etsy/statsd/wiki" target="_blank" rel="external">clients library</a> for almost all major programming language. In the meantime, StatsD can also serves as a local aggregator, providing a extensible backend architecture.</li>
<li><a href="http://docs.grafana.org/installation/rpm/" target="_blank" rel="external">Grafana</a> is a metrics dashboard that provides data visualization and generates statistic graph. You can choose the most suitable approach to install. Configuration file can be found <a href="http://docs.grafana.org/installation/configuration/" target="_blank" rel="external">here</a>.</li>
<li><a href="https://docs.influxdata.com/influxdb/v0.9/introduction/overview/" target="_blank" rel="external">InfluxDB</a> is a time-series database for storing the metrics data.</li>
</ul>
<h2 id="StatsD"><a href="#StatsD" class="headerlink" title="StatsD"></a>StatsD</h2><p>When the StatsD is placed in a suitable location, please edit <code>config.js</code> to configure StatsD to send data to InfluxDB. Possible example is as below:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1.&#123;</span><br><span class="line">2.    influxdb: &#123;</span><br><span class="line">3.        host: '127.0.0.1', // InfluxDB host. (default 127.0.0.1)</span><br><span class="line">4.        port: 8086, // InfluxDB port. (default 8086)</span><br><span class="line">5.        database: 'demo',  // InfluxDB database instance. (required)</span><br><span class="line">6.        username: 'root', // InfluxDB database username. (required)</span><br><span class="line">7.        password: 'root', // InfluxDB database password. (required)</span><br><span class="line">8.        flush: &#123;</span><br><span class="line">9.            enable: true // Enable regular flush strategy. (default true)</span><br><span class="line">10.        &#125;,</span><br><span class="line">11.        proxy: &#123;</span><br><span class="line">12.            enable: false, // Enable the proxy strategy. (default false)</span><br><span class="line">13.            suffix: 'raw', // Metric name suffix. (default 'raw')</span><br><span class="line">14.            flushInterval: 1000 // Flush interval for the internal buffer.</span><br><span class="line">15.                // (default 1000)</span><br><span class="line">16.        &#125;</span><br><span class="line">17.    &#125;,</span><br><span class="line">18.    port: 8125, // StatsD port.</span><br><span class="line">19.    backends: ['./backends/console’, 'statsd-influxdb-backend'],</span><br><span class="line">20.    debug: true,</span><br><span class="line">21.    legacyNamespace: false,</span><br><span class="line">22.    keyNameSanitize: false</span><br><span class="line">23.&#125;</span><br></pre></td></tr></table></figure>
<p>Please note that the key word <strong>backends</strong>, which specifies the destination of the metrics data, and the dependency could be installed as below:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.$ <span class="built_in">cd</span> statd</span><br><span class="line"><span class="number">2</span>.</span><br><span class="line"><span class="number">3</span>.$ npm install statsd-influxdb-backend <span class="operator">-d</span></span><br><span class="line"><span class="number">4</span>.</span><br><span class="line"><span class="number">5</span>.$ npm install</span><br></pre></td></tr></table></figure>
<p><code>flushInterval</code> is set to send batch of information to InfluxDB every 10s by default. <code>keyNameSanitize</code>, please set it to <code>false</code> when you are connecting InfluxDB or have some special characters in the name tags.</p>
<h2 id="Grafana"><a href="#Grafana" class="headerlink" title="Grafana"></a>Grafana</h2><p>Configuration for Grafana mainly contains two sections, one is for <code>Data Sources</code>, and another is for templating/query. I will focus on configure the data source in the article.</p>
<p>Since the DataSource can only be configured after organisation is created, it would be better to sign-up as root and create a default organisation. Then change the anonymous auth settings with your newly-created org. This will allow users without login view the stats information, but they won’t be able to modify the charts’.</p>
<p>If you created the root user (you may call it whatever you like), and login with the detail, you will find the DataSource section looks like this snapshot:</p>
<p><img src="/images/grafana/dataSource.png" alt=""></p>
<p>Select InfluxDB 0.9 as the latest (or whatever your influxDB version is), and then enter details you set for your InfluxDB instance. In the dashboard you may create a new graph point to your new data source.</p>
<h2 id="InfluxDB"><a href="#InfluxDB" class="headerlink" title="InfluxDB"></a>InfluxDB</h2><p>Once database service is started, the default port for Admin Web UI is <code>8083</code>, and DataSource Port is <code>8086</code>.</p>
<p>In the admin UI, the dropdown menu shows some template query for basic operation. As mentioned before influxDB offers a <a href="https://docs.influxdata.com/influxdb/v0.9/concepts/crosswalk/" target="_blank" rel="external">SQL-like query style</a>. Simply put, <code>MEASUREMENTS</code> is equivalent to <code>TABLE</code>, <code>TAGS</code> is equivalent to <code>COLUMNS</code>, and <code>POINTS</code> is equivalent to <code>ROW</code>. The above link shows a comprehensive induction on how to query InfluxDB.</p>
<p>This <a href="https://docs.influxdata.com/influxdb/v0.9/tools/shell/" target="_blank" rel="external">link</a> shows how to connect to InfluxDB with command-line, if you prefer a geeky way. To find a full document on how InfluxDB works in detail, please click here (Google Search always points to older version).</p>
<p>Once influxDB is installed, it would fairly easy to use. No much settings required.</p>
<p><img src="/images/grafana/influxdbSetting.png" alt=""></p>
<p>The <code>localhost</code> is the server where you installed the influxDB, and <code>8086</code> is the default port for querying data.</p>
<p><strong>Please leave a comment if you have any questions or correct me if there is an update on the new change for these applications.</strong></p>
</div></article></div></section><footer><div class="paginator"><a class="prev"></a><a href="/blog/hello-world/" class="next">Older</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'chenxili';
var disqus_identifier = 'blog/Grafana-Stack-with-InfluxDB/';
var disqus_title = 'Grafana Stack with InfluxDB';
var disqus_url = 'http://moremeds.github.io/blog/Grafana-Stack-with-InfluxDB/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//chenxili.disqus.com/count.js" async></script></footer><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>